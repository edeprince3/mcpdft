memory 6gb
# first, import vrdm_casscf_private library
sys.path.insert(0, './..')
import v2rdm_casscf
# second, import mcpdft library
sys.path.insert(0, './..')
import RDMinoles

molecule mol {
0 1
o
h 1 0.9
h 1 0.9 2 104.5
symmetry c1
}

set {
  basis sto-3g 
  # it is important that the scf_type is set to df for v2rdm-casscf (it is assumed in mcpdft)
  scf_type df
  d_convergence 1e-8
  # it is important that the reference is set to rhf/rohf for v2rdm-casscf
  reference rhf
}

set v2rdm_casscf {

  positivity dqg
  opdm_write_full true
  tpdm_write_full true
  constrain_spin true
  nat_orbs true
  r_convergence  1e-5
  e_convergence  1e-4
  cg_convergence 1e-6
  maxiter 1000000

  optimize_orbitals true

  mu_update_frequency 500

  #restricted_docc  [ 1, 0, 0, 0 ]
  #active           [ 3, 0, 1, 2 ]
  restricted_docc  [ 0 ]
  active           [ 6 ]

  #restricted_docc  [ 0 ]
  #active           [ 2 ]
}

# it is important that the reference is set to uks for mcpdft
set rdminoles {
  reference uks
  #mcpdft_lambda 0.2
  mcpdft_reference v2rdm
  mcpdft_type df
  mcpdft_functional blyp
  polyradical_analysis true
  #mcpdft_method lh_mcpdft #ls1dh_mcpdft
  mcpdft_method mcpdft #ls1dh_mcpdft
  write_qtaim_wfn true
}

# run v2rdm-casscf
en,wfn = energy('v2rdm-casscf',return_wfn=True)

# pass v2rdm-casscf wavefunction object into mcpdft
energy('mcpdft',ref_wfn=wfn)

